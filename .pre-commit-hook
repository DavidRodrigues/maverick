#!/bin/sh
# Based on https://medium.com/@randulakoralage82/format-your-net-code-with-git-hooks-a0dc33f68048
set -e
LC_ALL=C

# Select files to format
files=$(git diff --cached --name-only --diff-filter=ACM "Source/*.cs" | sed 's| |\\ |g')

# Check if there are .cs files to format
if [ -z "$files" ] 
then
    # Nothing to do
    exit 0
fi

# Ensure dotnet-format is present
if ! dotnet tool list -g | grep dotnet-format > /dev/null 2>&1
then 
    dotnet tool install -g dotnet-format
fi

# Format all selected files
echo "$files" | sed 's/Source\///' | cat | xargs | sed -e 's/ /,/g' | xargs dotnet-format --workspace=Source/ --files
# Add back the modified files to staging
echo "$files" | xargs git add
